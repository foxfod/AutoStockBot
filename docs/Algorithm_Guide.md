# 🧠 알고리즘 상세 가이드 (Algorithm Guide)

본 문서는 자동 매매 봇의 핵심 알고리즘(종목 선정, 매수, 매도, 리스크 관리, 오버나잇)에 대한 상세 로직을 설명합니다.

---

## 1. 종목 선정 (Stock Selection)
매 10분마다 실행되며, 시장 상황에 따라 유연하게 종목을 발굴합니다.

### 1.1 후보군 수집 (Sourcing)
1.  **시장 주도주 (Market Trend)**
    *   **소스**: 네이버 금융 뉴스 / Yahoo Finance 뉴스.
    *   **로직**: '특징주', '급등', '호재' 키워드가 포함된 뉴스를 크롤링하여 AI가 긍정적(Positive) 이슈인지 분석합니다.
    *   **비중**: 0순위 (가장 우선적으로 매수 검토).
2.  **거래량 급증 (Volume Spikes)**
    *   **소스**: KIS API 거래량 상위 조회.
    *   **로직**: 전일 대비 거래량이 급증하고 있는 종목 추출.

### 1.2 기술적 필터링 (Technical Filter)
수집된 후보군 중 다음 조건을 만족하는 종목만 남깁니다.
*   **RSI (14)**: **70 이하** (과열 구간 진입 전 매수).
*   **등락률**: 당일 **+15% 이하** (이미 너무 많이 오른 종목 제외).
*   **추세**: 이동평균선 정배열 (5일선 > 20일선) 선호.

### 1.3 AI 심층 분석 (Scoring)
필터링된 종목에 대해 AI(GPT/Gemini)가 최종 점수(0~100점)를 매깁니다.
*   **평가 항목**: 차트 패턴, 매물대 소화 여부, 재료의 지속성.
*   **진입 기준**: **80점 이상** 획득 시 매수 후보 등록.

---

## 2. 매수 집행 (Execution)
*   **슬롯(Slot)**: 최대 **3종목**까지만 동시 보유.
*   **자금 배분**: (예수금 / 남은 슬롯) * 0.98. (미수/신용 미사용)
*   **주문 방식**:
    *   **KR**: 현재가 지정가 주문 (미체결 시 취소 후 재주문 로직 없음, 쿨타임 후 재시도).
    *   **US**: 현재가 +1% 지정가로 즉시 체결 유도 (Safe Buy).

---

## 3. 매도 및 리스크 관리 (Exit & Risk Management)
보유 종목은 1분 단위(또는 실시간)로 감시됩니다.

### 3.1 익절 (Profit Taking)
1.  **목표가 달성**: 기본 +3~5% 도달 시 분할 매도.
2.  **트레일링 스탑 (Trailing Stop)**:
    *   **활성화**: 수익률 **+2%** 도달 시.
    *   **매도**: 고점 대비 **-1%** 하락 시 전량 매도.

### 3.2 손절 (Stop Loss)
1.  **하드 컷 (Hard Stop)**: 수익률 **-3%** 도달 시 무조건 매도.
2.  **스마트 컷 (AI Risk Cut)**:
    *   조건: 수익률 **-0.4%** 미만.
    *   동작: AI가 재분석하여 '추세 붕괴' 판단 시 즉시 매도. (10분 주기)

---

## 4. 오버나잇 전략 (Overnight Strategy)
단타(Day Trading)를 기본으로 하되, 강력한 상방 모멘텀이 있는 종목은 다음 날까지 보유(Swing)합니다.

*   **심사 시간**:
    *   **KR**: 15:10 ~ 15:15
    *   **US**: 05:35 ~ 05:40
*   **프로세스**:
    1.  보유 중인 종목 리스트 확인.
    2.  **손실 제한**: 수익률이 **-3%** 이하인 깊은 손실 종목은 오버나잇 불가 (장 마감 전 청산).
    3.  **AI 판단**: AI에게 현재가, 수익률, 차트, 뉴스를 제공하여 **"내일 갭상승 가능성"**을 질문.
    4.  **결과 적용**:
        *   **HOLD**: `overnight` 플래그 설정 -> 당일 청산 로직에서 제외.
        *   **LIQUIDATE**: 플래그 미설정 -> 장 마감 청산 로직에 의해 매도됨.

---

## 5. 장 마감 청산 (Liquidation)
오버나잇 승인을 받지 못한 모든 종목은 장 종료 전 전량 매도합니다.
*   **KR**: 15:15 부터 시장가(또는 하한가) 매도 시도.
*   **US**: 05:40 부터 현재가 -5% 지정가로 매도 시도.
