# 버전 히스토리 (Version History)

이 문서는 프로젝트의 주요 변경 사항과 업데이트 내역을 기록합니다.

## [v.20260209_010] 시스템 안정화 및 대시보드 개선

### [v.20260209_010-01] 수익률 표시 오류 수정 (Profit Rate Fix)
- **문제**: 대시보드 수익률이 일일 등락률과 혼동되거나, 갱신이 지연되는 문제.
- **수정**:
    - `main.py`: `daily_change`(일일 변동률) 계산 로직 추가.
    - `kis_api.py`: 실시간 시세 조회 시 `prev_close`(전일 종가) 데이터 포함.
    - `dashboard.html`: 종목 카드에 **Total P&L**(총 수익률)과 **Daily Change**(일일 변동률)을 구분하여 표시.

### [v.20260209_010-02] 미국 주식 동기화 오류 수정 (US Stock Sync Fix)
- **문제**: 미국 주식 보유량이 실제보다 많이 표시되거나(중복), 아예 표시되지 않는 문제.
- **수정**:
    - `kis_api.py`: 여러 거래소(NASD, NYSE, AMEX) 조회 시 발생하는 중복 종목 제거 로직(Deduplication) 추가.
    - `trade_manager.py`: 미국 주식 동기화 과정에 상세 디버그 로그 추가.

### [v.20260209_010-03] 주문 가능 금액 초과 오류 수정 (Insufficient Funds Fix)
- **문제**: 매수 주문 시 잔고를 100% 사용하여 수수료나 시장가 변동으로 인해 주문 거부 발생.
- **수정**:
    - `trade_manager.py`: 매수 수량 계산 시 **안전 버퍼(Safety Buffer)** 적용.
        - **미국 주식**: 예산의 **98%** 사용 (지정가 +1% 및 수수료 고려).
        - **한국 주식**: 예산의 **95%** 사용 (시장가 변동성 고려).

### [v.20260209_010-04] 대시보드 UI/UX 개선
- **기능 추가**:
    - 슬롯 영역(KR/US) 클릭 시 해당 국가 종목만 필터링하여 보여주는 기능 추가.
    - 웹소켓 연결 오류 수정 (`connectWebSocket` 함수 복구).

### [v.20260209_010-05] 버전 관리 시스템 (Versioning System)
- **기능 추가**:
### [v.20260209_010-06] 대시보드 콘솔 에러 수정 (Console Fix)
- **문제**: 대시보드 로딩 시 `fetchState is not defined`, `logContainer is not defined` 에러 발생.
- **수정**:
### [v.20260209_010-07] 동시 주문 시 잔고 부족 오류 수정 (Multi-Buy Insufficient Funds Fix)
- **문제**: 여러 종목 동시 매수 시, API 잔고 갱신 지연으로 인해 초기 잔고 기준으로 중복 계산되어 주문 거부 발생.
- **수정**:
    - `trade_manager.py`: 매수 루프 내에서 잔고를 실시간으로 차감(`current_kr_cash`)하여 다음 종목 계산에 반영.
    - API `update_balance` 호출을 루프 내부에서 제거하여 Stale Data 참조 방지.

### [v.20260209_010-08] AI 분석 정확도 향상 (AI Accuracy)
- **문제**: AI 분석 시 시장 환경 정보(Market Context)가 누락되어, 하락장에서도 공격적인 매수를 추천함.
- **수정**: `ai_analyzer.py` 프롬프트에 시장 상태(Bull/Bear)를 주입하고, 하락장 시 보수적 기준을 적용하도록 로직 개선.

### [v.20260209_010-09] 시장가 주문 잔고 부족 수정 (Market Order Margin Fix)
- **문제**: 시장가 주문(Price=0) 시 거래소가 '상한가(+30%)' 기준으로 증거금을 요구하여, 잔고가 충분함에도 `주문가능금액 초과` 오류 발생.
- **수정**: KR 종목 매수 수량 계산 시 분모를 `현재가` 대신 `현재가 * 1.3`으로 변경하여 증거금 부족 방지.

### [v.20260209_010-10] 변수 참조 오류 긴급 수정 (Hotfix)
- **문제**: Patch 09 적용 과정에서 `safe_invest_amt` 변수 정의가 누락되어 `UnboundLocalError` 발생.
- **수정**: `trade_manager.py` 내 KR 매수 로직에 `safe_invest_amt` 변수 선언 복구.
